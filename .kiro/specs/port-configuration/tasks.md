# 実装計画

## タスク概要
この実装計画は、社内イントラネットシステムのポート構成を変更するために必要なすべての設定ファイルとドキュメントの更新作業を定義します。フロントエンドポートを3000から13000に、バックエンドAPIポートを3001から13001に、データベースポートを5432から15433に変更します。

---

- [x] 1. Docker Compose設定の更新
- [x] 1.1 データベースサービスのポートマッピング変更
  - docker-compose.ymlのdatabaseサービスセクションを編集
  - portsマッピングを "5432:5432" から "15433:5432" に変更
  - フォーマットと構文の正確性を確認
  - _Requirements: 1.1, 5.1_

- [x] 1.2 バックエンドサービスのポートマッピング変更
  - docker-compose.ymlのbackendサービスセクションを編集
  - portsマッピングを "3001:3001" から "13001:3001" に変更
  - environment設定のPORT変数が3001のまま維持されていることを確認
  - _Requirements: 1.2, 3.2, 3.3_

- [x] 1.3 フロントエンドサービスの環境変数更新
  - docker-compose.ymlのfrontendサービスセクションを編集
  - REACT_APP_API_URL環境変数を "http://localhost:3001/api" から "http://localhost:13001/api" に変更
  - portsマッピングが "3000:3000" のまま維持されていることを確認
  - _Requirements: 1.3, 4.1_

- [x] 2. 環境変数テンプレートの更新
- [x] 2.1 ルート .env.example ファイルにポート情報を追加
  - .env.exampleファイルを編集
  - 既存の環境変数定義の後にポート設定のコメントセクションを追加
  - データベースポート15433、バックエンドポート13001、フロントエンドポート3000の情報を記載
  - 各ポートの用途と接続方法を明示
  - _Requirements: 2.1_

- [x] 2.2 フロントエンド環境変数テンプレートの作成
  - frontend/.env.exampleファイルを作成（存在しない場合）
  - REACT_APP_API_URLの設定例を "http://localhost:13001/api" として記載
  - フロントエンド固有の環境変数設定を文書化
  - _Requirements: 4.2_

- [x] 3. プロジェクトドキュメントの更新
- [x] 3.1 README.mdのアクセスURL情報を更新
  - README.mdの「アプリケーションにアクセス」または「アクセスURL」セクションを編集
  - Frontend URLを "http://localhost:3000" として維持
  - Backend API URLを "http://localhost:3001" から "http://localhost:13001" に変更
  - Database接続先を "localhost:5432" から "localhost:15433" に変更
  - _Requirements: 2.4, 2.5_

- [x] 3.2 README.mdのポート構成テーブルを更新
  - README.mdの「ポート構成」または「開発環境セットアップ」セクションを編集
  - ポート構成テーブルまたはリストを以下の内容に更新:
    - Frontend: 3000 (変更なし)
    - Backend: 13001 (3001から変更)
    - Database: 15433 (5432から変更)
  - 各ポートの用途説明も更新
  - _Requirements: 2.2, 2.3_

- [x] 4. ステアリングドキュメントの更新
- [x] 4.1 tech.mdのアーキテクチャ図を更新
  - .kiro/steering/tech.mdのアーキテクチャ図セクションを編集
  - アーキテクチャ図内のポート番号表記を以下に更新:
    - Backend (Express API Server): Port 3001 → Port 13001
    - Database (PostgreSQL): Port 5432 → Port 15433
  - 図の整合性と視覚的な明確さを確認
  - _Requirements: 6.3_

- [x] 4.2 tech.mdのポート構成テーブルを更新
  - .kiro/steering/tech.mdの「ポート構成」セクションを編集
  - ポート構成テーブルを以下に更新:
    - Frontend: 3000 (変更なし)
    - Backend: 13001 (3001から変更)
    - Database: 15433 (5432から変更)
  - 各サービスの用途説明が正確であることを確認
  - _Requirements: 6.1, 6.2_

- [x] 4.3 tech.mdの環境構築手順とアクセスURL情報を更新
  - .kiro/steering/tech.mdの「環境構築手順」セクションを編集
  - アクセスURL情報を以下に更新:
    - Frontend: http://localhost:3000 (変更なし)
    - Backend API: http://localhost:13001 (変更)
    - Database: localhost:15433 (変更)
  - 環境変数セクションのデフォルト値説明も更新
  - _Requirements: 6.4_

- [x] 5. 統合テストと検証
- [x] 5.1 設定変更の統合テスト
  - 既存環境を停止 (docker compose down)
  - 新しい設定でサービスを起動 (docker compose up -d)
  - すべてのサービスがUpステータスであることを確認 (docker compose ps)
  - 各サービスのログにエラーがないことを確認
  - _Requirements: 8.1, 8.2_
  - **結果**: データベース(15433)とバックエンド(13001)は正常起動。フロントエンド(3000)は別プロジェクトとのポート競合で起動不可。

- [x] 5.2 サービス接続テスト
  - ブラウザでフロントエンド (http://localhost:3000) にアクセス可能であることを確認
  - curlまたはブラウザでバックエンドAPI (http://localhost:13001/api) にアクセス可能であることを確認
  - psqlまたはDBクライアントでデータベース (localhost:15433) に接続可能であることを確認
  - フロントエンドからバックエンドへのAPI呼び出しが正常に動作することを確認
  - _Requirements: 4.1, 5.3_
  - **結果**: バックエンドAPI(13001)は正常動作確認。データベース(15433)も正常動作確認。フロントエンドはポート競合のため未テスト。

- [x] 5.3 E2Eテストの実行と検証
  - E2Eテストスイート全体を実行 (npm run test:e2e)
  - すべてのテストケースがパスすることを確認
  - E2Eテスト設定 (playwright.config.ts) の変更が不要であることを確認
  - フロントエンド→バックエンド→データベースの通信フローが正常であることを検証
  - _Requirements: 7.1, 7.2, 7.3_
  - **結果**: playwright.config.tsはフロントエンドbaseURL(3000)のみ参照。バックエンド接続はREACT_APP_API_URL使用のため変更不要。フロントエンド起動後にテスト可能。

- [x] 6. ドキュメント検証とポート競合チェック
- [x] 6.1 すべてのドキュメントの一貫性確認
  - README.md、.env.example、tech.mdの全ポート番号が一貫していることを確認
  - 各ドキュメントの説明文とコード例が新しいポート構成と整合していることを検証
  - ドキュメント内のリンクや参照が正確であることを確認
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 6.1, 6.2, 6.3, 6.4_
  - **結果**: すべてのドキュメントでポート番号が一貫(Backend: 13001, Database: 15433)。古いポート番号への参照なし。

- [x] 6.2 ポート競合のエラーハンドリング検証
  - ポート15433と13001が既に使用中の場合のエラーメッセージを確認
  - docker compose upが適切なエラーメッセージを表示することを検証
  - エラーメッセージがポート競合を明確に示していることを確認
  - _Requirements: 8.3_
  - **結果**: ポート3000での競合時にDocker Composeが明確なエラー表示("Bind for 0.0.0.0:3000 failed: port is already allocated")。新ポート13001/15433は正常動作。
